<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Health Registry Test</title>
  <style>
    body { font-family: sans-serif; margin: 30px; max-width: 600px; }
    label { display:block; margin-top:10px; }
    button { margin-top:20px; padding:8px 16px; }
    #output { margin-top:20px; font-weight:bold; }
  </style>
</head>

<body>
  <h2>Patient Demographics</h2>

  <form id="dataForm">
    <label>Patient ID 1: <input type="text" name="id1" required></label>
    <label>Patient ID 2: <input type="text" name="id2" required></label>

    <label>Gender:
      <select name="gender">
        <option>Male</option>
        <option>Female</option>
      </select>
    </label>

    <label>Smoker?
      <input type="radio" name="smoke" value="Yes"> Yes
      <input type="radio" name="smoke" value="No"> No
    </label>

    <div id="smokeDetails" style="display:none;">
      <label>Type of smoking: <input name="smoke_type"></label>
      <label>Years smoked: <input name="smoke_years" type="number"></label>
    </div>

    <button type="submit">Submit</button>
  </form>

  <div id="output"></div>

  <script>
    // --- Show / hide smoking details ---
    const smokeRadios = document.querySelectorAll('input[name="smoke"]');
    smokeRadios.forEach(r => r.addEventListener('change', () => {
      document.getElementById('smokeDetails').style.display =
        (r.value === 'Yes' && r.checked) ? 'block' : 'none';
    }));

    // --- Handle form submission ---
    const form = document.getElementById('dataForm');
    form.addEventListener('submit', e => {
      e.preventDefault();

      const data = Object.fromEntries(new FormData(form));
      const scriptURL = 'https://script.google.com/macros/s/AKfycbxNSpck42Y38qb2UGrD58HsOsqPH89cAiNUtO28hc_5pAYT13unwaR-hE843VPsnTN9/exec';

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data)
      })
      .then(async r => {
        try {
          const res = await r.json();
          if (res.status === 'success') {
            document.getElementById('output').innerText = '✅ Submission sent successfully!';
            alert('✅ ' + res.message);
            form.reset();
            document.getElementById('smokeDetails').style.display = 'none';
          } else {
            document.getElementById('output').innerText = '❌ Submission failed!';
            alert('❌ Error: ' + res.message);
          }
        } catch (e) {
          // fallback for plain-text response
          const text = await r.text();
          if (text.includes('OK')) {
            document.getElementById('output').innerText = '✅ Submission sent successfully!';
            alert('✅ Saved OK (plain text)');
            form.reset();
            document.getElementById('smokeDetails').style.display = 'none';
          } else {
            throw e;
          }
        }
      })
      .catch(err => {
        document.getElementById('output').innerText = '🚨 Network error: ' + err;
        alert('🚨 Network error: ' + err);
      });
    });
  </script>
</body>
</html>
